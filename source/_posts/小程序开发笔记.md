---
title: 小程序开发笔记
categories:
  - 小程序
tags:
  - 小程序
date: 2018-10-09T17:32:47.000Z
style: ocean
---
最近我参与了一个小程序的开发，对于小程序开发我是零基础，所以特此记录一些小程序开发中的技术点。
<!--more-->

## 设值与取值

### 动态修改变量的值

在data对象中创建一个变量

	data: {
	  value: 0 
	}

修改变量的值

	this.setData({
	    value: 10 
	});

### 在wxml中使用变量

	<view class="page" value="{{ value }}">{{{ value }}</view>

### 在JavaScript代码中使用变量

	func: function () {

	  //value是在data对象中定义的变量
	  this.data.value
	}

### 动态修改对象的属性值

在data对象中创建一个包含一些属性的对象

	data: {
	  obj: {
	    value: 0
	  }
	}

修改对象的属性值

	this.setData({
	    ["obj.value"]: 10 
	});

### 在wxml中使用对象的属性

	<view class="page" value="{{ obj.value }}">{{{ obj.value }}</view>

### 在JavaScript代码中使用对象的属性

	func: function () {

	  //value是在data对象中定义的obj对象的属性
	  this.data.obj.value
	}

## 数据存储方案

### 将数据保存到本地

	wx.setStorageSync("value", 10);

### 读取保存在本地的数据

	var value = wx.getStorageSync("value");
	if (value != "" && value != undefined && value != null) {
	  console.log("读取到了保存在本地的数据，保存在本地的数据为:", value);
	} else {
	  console.log("没有读取到保存在本地的数据");
	}

### 清除保存在本地的某个数据

	wx.removeStorageSync("value");

### 清除所有保存在本地的数据

	wx.clearStorageSync();

### 小程序在手机上运行时不能清除本地数据的解决方法

	try {
	  wx.clearStorageSync();
	} catch (e) {
	  wx.showToast({
	    title: "数据清除异常",
	    icon: 'none',
	    duration: 2000
	  })
	}

## 数据渲染

### 声明式渲染

小程序允许采用简洁的模板语法来声明式地将数据渲染进 DOM 的系统

在wxml中添加一段小程序的布局代码

	<view class="page">{{ message }}</view>

在data对象中定义一个message变量，并给变量设置一个值，此时变量的值便会渲染到页面中

	data: {
		message: "这是一个小程序的页面"
	}

在页面中的效果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101201.png)

### 条件渲染

在wxml中添加一段小程序的布局代码

	<view  class="page"  wx:if="{{ isShow }}">这是一个小程序的页面</view>

在data对象中定义一个bool类型的变量isShow，此时页面会根据isShow变量的值的不同实现数据的显示或者隐藏，当isShow为true时显示数据，当isShow为false时隐藏数据

	data: {
		isShow: false
	},

当isShow为true时显示的效果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101201.png)

当isShow为false时隐藏的效果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101202.png)

### 列表渲染

在wxml中添加一段布局代码

	<view  class="list">
		<view  class="item"  wx:for="{{items}}"  wx:key="{{item}}">{{item.text}}</view>
	</view>

在data对象中定义一个数组，此时页面会按照数组中的数据渲染

	data: {
		items: [
		  { text: "学习 JavaScript" },
		  { text: "学习 Vue" },
		  { text: "学习小程序" },
		  { text: "整个牛项目" },
		]
	}

运行结果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101203.png)

### 给标签绑定一个点击时的回调函数

在wxml中添加一个标签，并给标签绑定一个点击时的回调函数

	<button bindtap="onNextStep">下一步</button>

在js中定义回调函数

	onNextStep: function() {
		console.log("你点击了下一步按钮");
	}

## 页面跳转

在小程序中有两种方式实现页面跳转，分别为**wx.navigateTo**和**wx.redirectTo**，其中**wx.navigateTo**实现的页面跳转后会保留上一个页面，当点击左上角的返回按钮后可以返回到上一个页面，**wx.redirectTo**实现的页面跳转当跳转到下一个页面后会销毁上一个页面，当点击左上角的返回按钮后不能返回到上一个页面

### 使用wx.navigateTo实现页面跳转的写法

	wx.navigateTo({
		url: "/pages/planunitform/index"
	});

### 使用wx.redirectTo实现页面跳转的写法

	wx.redirectTo({
		url: "/pages/planunitform/index"
	});

## 对话框

### 显示Toast对话框

	wx.showToast({
	    title: "电厂机组不能为空",
	    icon: "none",
	    duration: 2000 
	});

代码运行结果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101204.png)


### 显示确认取消对话框

	 wx.showModal({
		  title: '提示',
		  content: '评估完成，是否重新进行新的评估？',
		  success: function (result) {
			if (confirm) {
			  console.log("你点击了确认按钮");
			} else {
			  console.log("你点击了取消按钮");
			}
		  }
	});

代码运行结果
![](http://oq3pg8pg4.bkt.clouddn.com/2018101205.png)

## 当选项中有一项选否时，显示下一项

在做小程序过程中遇到一个需求，就是进入某个页面后，页面中有一些选项，在初始状态下只展示第一项，并且该项默认处于选中状态，当选中该项的否时显示下一项，直到显示到选择最后一项，当选中的是除最后一项之外的每项的是时，隐藏后面的选项

最终实现的效果如下
![](http://oq3pg8pg4.bkt.clouddn.com/2018101501.gif)

### 实现方式
在wxml中第1项的实现代码如下，后面其他项的实现代码与第1项类似，只是索引（shutstepi.currIndex >= 1 ）不同和选项的不同

	<view class="screenform-list" wx:if="{{ shutstepi.currIndex >= 1 }}">
	    <view class="top-title">
	        <span class="top-title-icon"></span>
	        <text>停堆始发事件</text>
	    </view>
	    <view class="screenform-item">
	        <view class="screenform-question">1.发现项所导致的结果是否会增加停堆始发事件的发生可能性？</view>
	        <view class="screenform-select">
	            <radio-group class="radio-group" id="1" bindchange="onRadioChange">
	                <label class="radio">
	                    <radio checked="{{shutstepi.currIndex == 1 ? true : false}}" value="1"/>
	                    是
	                </label>
	                <label class="radio">
	                    <radio checked="{{shutstepi.currIndex > 1 ? true : false}}" value="0"/>
	                    否
	                </label>
	            </radio-group>
	        </view>
	    </view>
	</view>

在js中的实现代码如下

在data对象中定义一个用于标记当前选中项的索引的变量，因为这个小程序中有多个地方都需要这个功能，所以我将这个索引定义在一个对象下面以便区分

	data: {
	  shutstepi: {
	
	    //当前选中项的索引
	  	currIndex: 1
	  }
	},

监听单选按钮的选中事件

  //单选按钮响应函数
  onRadioChange: function(e) {

      //如果当前项选中的是否
      if (e.detail.value == 0) {

          //显示下一项
          this.setData({
              ['shutstepi.currIndex']: parseInt(e.target.id) + 1
          });

      //如果当前选中的是“是”
      } else {

          //显示当前选中的选
          this.setData({
              ['shutstepi.currIndex']: parseInt(e.target.id)
          });
      }
## 以上选项都不选中

这次小程序中还有一个需求，在多选中有一个以上选项都不选中按钮，当选中以上选项都不选中时，之前选中的选项由选中状态变为不选中状态，当选中除以上选项都不选中的其他选项时，以上选项都不选中的选项变为不选中状态
![](http://oqdyj5870.bkt.clouddn.com/2018101502.gif)

### 实现方式

wxml中的布局代码如下

	<view class="screenform-item">
	  <view class="screenform-question">1.如果假定设备或安全功能完全丧失或不可用，是否影响如下方面？</view>
	  <checkbox-group bindchange="onCheckboxChange">
	    <label class="checkbox" wx:for="{{checkList}}" wx:key="item">
	      <checkbox value="{{item.name}}" checked="{{tools.checkedTool(powerfive.check, item.name)}}" />{{item.value}}
	    </label>
	  </checkbox-group>
	  <view class='font-color'>注：如果有影响，跳转到阶段3。</view>
	</view>

js代码

	data: {

		checkList: [{
			name: "1",
			value: "引发电厂停机停堆，或导致始发事件；"
		  },
		  {
			name: "2",
			value: "导致多列安全系统或功能的两列或多列降级；"
		  },
		  {
			name: "3",
			value: "导致支持安全系统或功能的系统的一列或多列降级。"
		  },
		  {
			name: "4",
			value: "以上都不受影响"
		  }
		],

		//记录多选的选项
		powerfive: {
		  check: [],
		  radioIndex: 0
		}
	  },
		
	//多选按钮响应函数
	onCheckboxChange: function(e) {

	//获得当前用户选择的选项中的值
	var array = e.detail.value;

	//如果最后一项选择的是第4项(最后一项选择的是“以上都不受影响”)
	if (array[array.length - 1] == '4') {

	  //只选择第4项
	  array = ['4'];

	  this.setData({
		  ["powerfive.radioIndex"]: 1
	  });

	  //如果第1项选择的是第4项(第一项选择的是“以上都不受影响”)
	} else if (array[0] == '4') {

	  //移除选择的第4项
	  array.splice(0, 1);

	  this.setData({
		  ["powerfive.radioIndex"]: 0
	  });
	}

	this.setData({
	  ['powerfive.check']: array
	});
	},

	//判断数组array中是否包含selectValue元素包含返回true
	checkedTool:function (array,selectValue) {
		var checked = false;
		for (var i = 0; i < array.length; ++i) {
			if (array[i] == selectValue) {
				checked = true;
				break;
			}
		}
		return checked;
	}

		
## 参考链接
- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/quickstart/basic/file.html)
- [微信小程序页面跳转导航wx.navigateTo和wx.redirectTo](http://www.phpos.net/xiaochengxu/api/575.html)

> meishadevs欢迎任何形式的转载，但请务必注明出处，尊重他人劳动成果。
转载请注明： 【文章转载自meishadevs：[小程序开发笔记](http://meishadevs.com/blog/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/)】