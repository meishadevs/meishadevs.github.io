---
title: 代码规范类问题修改方法
categories:
  - null
  - null
tags:
  - null
  - null
date: 2018-11-19 15:44:47
---
<!--more-->

**问题描述:** Define a constant instead of duplicating this literal "total" 3，表示一个字符串重复使用了3次
**解决方法:** 将多次重复使用的字符串定义成一个字符串常量，使用时直接调用定义的字符串常量

	private static final String TOTAL = "total";

**问题描述:** Either log or rethrow this exception
**解决方法:** catch语句中不能为空，添加一些代码，当时当使用logger打印出日志时，需要传递两个参数，且第二个参数值为e
**修改前的代码**
**修改后的代码**

**Replace this usage of Sun classes by ones from the Javal，解决方法，删掉无用的java包**
![](2018111603.png)

**Move constants to a class or enum，解决方法，常量不应定义在一个接口中**
![](2018111604.png)


**Replace this usage of System.out or System.err by a，解决方法，删掉日志打印语句**
![](2018111605.png)


**Return an empty array instead of null，解决方法，将null改成空数组**
![](2018111606.png)

**Remove this unused method parameter "isAjax，解决方法，移除掉无用的变量**
![](2018111607.png)



## 4 duplicated blocks of code must be removed，解决方法，优化代码的实现逻辑

## 优化前的代码

~~~ javascript



/**

     * 获得资源状态

     * @param userId 用户id

     * @param resType 资源类型(1：Oracle、2：SGRDB、3：N-Base)

     * @return

     */

    @ResponseBody

    @RequestMapping("/getResourceStatus")

    public Map<String, Object> getResourceStatus(long userId, long resType) {



        Map<String, Object> info = null;

        Map<String, Object> warn = null;

        Map<String, Object> error = null;

        Map<String, Object> fatal = null;

        long infoCount ;

        long warnCount ;

        long errorCount ;

        long fatalCount ;



        //获得资源状态

        if (resType == 1) {

            info = service.getOracleStatus(userId, 1);

            warn = service.getOracleStatus(userId, 2);

            error = service.getOracleStatus(userId, 3);

            fatal = service.getOracleStatus(userId, 4);



        } else if (resType == 2) {

            info = service.getSgrdbStatus(userId, 1);

            warn = service.getSgrdbStatus(userId, 2);

            error = service.getSgrdbStatus(userId, 3);

            fatal = service.getSgrdbStatus(userId, 4);



        } else if (resType == 3) {

            info = service.getNbaseStatus(userId, 1);

            warn = service.getNbaseStatus(userId, 2);

            error = service.getNbaseStatus(userId, 3);

            fatal = service.getNbaseStatus(userId, 4);

        }



        //信息

        if (info != null) {

            infoCount = (long)getFirstOrNull(info);

        } else {

            infoCount = 0;

        }



        //警告

        if (warn != null) {

            warnCount = (long)getFirstOrNull(warn);

        } else {

            warnCount = 0;

        }



        //错误

        if (error != null) {

            errorCount = (long)getFirstOrNull(error);

        } else {

            errorCount = 0;

        }



        //致命

        if (fatal != null) {

            fatalCount = (long)getFirstOrNull(fatal);

        } else {

            fatalCount = 0;

        }



        //信息

        JSONObject infoJson = new JSONObject();

        infoJson.put(HomePageConstant.WARN_LEVEL, 1);

        infoJson.put(HomePageConstant.WARN_LEVEL_STR, "信息");

        infoJson.put(HomePageConstant.COUNT, infoCount);



        //警告

        JSONObject warnJson = new JSONObject();

        warnJson.put(HomePageConstant.WARN_LEVEL, 2);

        warnJson.put(HomePageConstant.WARN_LEVEL_STR, "警告");

        warnJson.put(HomePageConstant.COUNT, warnCount);



        //错误

        JSONObject errorJson = new JSONObject();

        errorJson.put(HomePageConstant.WARN_LEVEL, 3);

        errorJson.put(HomePageConstant.WARN_LEVEL_STR, "错误");

        errorJson.put(HomePageConstant.COUNT, errorCount);



        //致命

        JSONObject fatalJson = new JSONObject();

        fatalJson.put(HomePageConstant.WARN_LEVEL, 4);

        fatalJson.put(HomePageConstant.WARN_LEVEL_STR, "致命");

        fatalJson.put(HomePageConstant.COUNT, fatalCount);



        Map<String, Object> map = new HashMap<String, Object>();

        map.put("info", infoJson);

        map.put("warn", warnJson);

        map.put(HomePageConstant.ERROR, errorJson);

        map.put(HomePageConstant.FATAL, fatalJson);



        return map;

    }

~~~



## 优化后的代码

	/**
	
	     * 获得资源状态
	
	     * @param userId 用户id
	
	     * @param resType 资源类型(1：Oracle、2：SGRDB、3：N-Base)
	
	     * @return
	
	     */
	
	    @ResponseBody
	
	    @RequestMapping("/getResourceStatus")
	
	    public Map<String, Object> getResourceStatus(long userId, long resType) {
	
	
	
	        Map<String, Object> warnObj = null;
	
	        Map<String, Object> map = new HashMap<String, Object>();
	
	        int[] warnNo = {1, 2, 3, 4};
	
	        String[] warnText = {"信息", "警告", "错误", "致命"};
	
	        String[] warnStr = {INFO, WARN, ERROR, FATAL};
	
	
	
	        //遍历告警等级
	
	        for (int warnLevel = 1; warnLevel <= 4; warnLevel++) {
	
	
	
	            if (resType == 1) {
	
	                warnObj = service.getOracleStatus(userId, warnLevel);
	
	
	
	            } else if (resType == 2) {
	
	                warnObj = service.getSgrdbStatus(userId, warnLevel);
	
	
	
	            } else if (resType == 3) {
	
	                warnObj = service.getNbaseStatus(userId, warnLevel);
	
	            }
	
	
	
	            JSONObject warnJson = new JSONObject();
	
	            warnJson.put(WARN_LEVEL, warnNo[warnLevel - 1]);
	
	            warnJson.put(WARN_LEVEL_STR, warnText[warnLevel - 1]);
	
	            warnJson.put(COUNT, warnObj != null ? (long)getFirstOrNull(warnObj) : 0);
	
	            map.put(warnStr[warnLevel - 1], warnJson);
	
	        }
	
	
	
	        return map;
	
	    }

**Refactor this method to reduce its Cognitive Complexity，解决方法，将一段复杂的代码提取出来，封装到一个方法中**
![](2018111608.png)

**Reduce the number of conditional operators (7) used in，解决方法，将语句拆分成多个方法**

**修改前的代码**
![](2018111703.png)

**修改后的代码**
![](2018111702.png)



# Refactor this code to not nest more than 3，表示代码的复查度较高，需要重构代码，降低代码的复杂度，解决方法是重构代码，降低代码的复杂度

**修改前的代码**

![](2018111801.png)



## 修改后的代码

![](2018111802.png)



# Change this "try" to a try-with-resource，解决方法，使用try-with-resource代替try-catch

## 参考资料：[java 7 新特性 try-with-resources](https://www.jianshu.com/p/3ab87269140c)



## 修改前的代码

![](2018111803.png)



## 修改后的代码

![](2018111804.png)



# Either log or rethrow this exception，修改方法，在catch中打印日志

![](2018111901.png)



# Remove this unused private "initInstanceNodeTree"，修改方法，将私有方法改成公有方法

![](2018111902.png)



# This block of commented-out lines of code should be，修改方法，去掉这行代码注释

## 参考资料[sonar常见错误以及处理方案](https://my.oschina.net/u/238296/blog/677962)

![](2018112001.png)






















> meishadevs欢迎任何形式的转载，但请务必注明出处，尊重他人劳动成果。
转载请注明： 【文章转载自meishadevs：[]()】